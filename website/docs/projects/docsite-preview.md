## Principles

The principle of this preview project is to generate the content of the docs site from a PR, and then you can deploy the docs site to preview the content of the PR.

The original docs site generation process is:

1. Create a PR to update the docs site content in the `pingcap/docs`, `pingcap-docs-cn`, and `pingcap-docs-tidb-operator` repositories.
2. After the PR is merged, trigger the `pingcap/docs-staging` repository to update the content of the docs site.

    The workflow is [`dispatch.yml`](https://github.com/pingcap/docs/blob/master/.github/workflows/dispatch.yml).

    The workflow triggers the [`pingcap/docs-staging/workflows/update.yml`](https://github.com/pingcap/docs-staging/blob/main/.github/workflows/update.yml) workflow with the merge commit SHA of the PR as the input parameter.

3. After the content of the docs site is updated, trigger the `pingcap/website-docs` repository to deploy the docs site.

## Update scaffold

What is the scaffold of this docs site?

It is the markdown-pages directory with the TOC.md, _index.md, and _docHome.md files, and the docs.json file.

The expected structure is:

```bash
.
├── docs.json
├── markdown-pages
│   ├── en
│   │   ├── tidb
│   │   │   ├── master
│   │   │   │   ├── TOC.md
│   │   │   │   ├── _docHome.md
│   │   │   │   ├── _index.md
│   │   │   ├── release-3.0
│   │   │   ├── release-4.0
│   │   │   ├── release-5.0
│   │   │   ├── release-5.1
│   │   │   ├── release-5.2
│   │   │   ├── release-5.3
│   │   │   ├── release-5.4
│   │   │   ├── release-6.1
│   │   │   ├── release-6.5
│   │   │   ├── release-6.6
│   │   │   ├── release-7.0
│   │   │   ├── release-7.1
│   │   │   └── release-7.2
│   │   ├── tidb-data-migration
│   │   │   └── release-5.3
│   │   ├── tidb-in-kubernetes
│   │   │   ├── master
│   │   │   │   ├── TOC.md
│   │   │   │   ├── _docHome.md
│   │   │   │   ├── _index.md
│   │   │   ├── release-1.2
│   │   │   ├── release-1.3
│   │   │   ├── release-1.4
│   │   │   └── release-1.5
│   │   └── tidbcloud
│   │       └── master
│   │   │   │   ├── TOC.md
│   │   │   │   ├── _docHome.md
│   │   │   │   ├── _index.md
│   ├── ja
│   │   ├── tidb
│   │   │   ├── release-5.4
│   │   │   ├── release-6.1
│   │   │   ├── release-6.5
│   │   │   └── release-7.1
│   │   └── tidbcloud
│   │       └── master
│   └── zh
│       ├── tidb
│       │   ├── master
│       │   ├── release-3.0
│       │   ├── release-4.0
│       │   ├── release-5.0
│       │   ├── release-5.1
│       │   ├── release-5.2
│       │   ├── release-5.3
│       │   ├── release-5.4
│       │   ├── release-6.1
│       │   ├── release-6.5
│       │   ├── release-6.6
│       │   ├── release-7.0
│       │   ├── release-7.1
│       │   └── release-7.2
│       ├── tidb-data-migration
│       │   └── release-5.3
│       └── tidb-in-kubernetes
│           ├── master
│           ├── release-1.2
│           ├── release-1.3
│           ├── release-1.4
│           └── release-1.5
```

## Preview locally

### `build.sh`

## PR preview

PR content = scaffold + PR changes

## Deploy preview

### Using Vercel/Netlify/Cloudflare Pages

## Unit test

The test folder:

```
- test
    - feature
        - data (expected by the test, committed to git)
        - actual (generated by the test, ignored by git)
        - test script
```

In each test script:

1. Generate the actual folder with copyed script. => function (init)
2. Execute the test script. => function
3. Compare the actual folder with the data folder. => function
